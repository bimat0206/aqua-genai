# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [2025-06-18] 1.0.1 - Initial Release


### Added
- Migrated infrastructure management from CloudFormation to Terraform.
- Implemented multiple Lambda functions, each dedicated to a specific API path (`/validate`, `/catalog`, `/transaction/{id}`, `/transactions`).
- Updated API Gateway to route requests to the corresponding dedicated Lambda functions.
- Configured IAM roles and ECR repositories to support the multi-Lambda architecture.
- **API Gateway + Secrets Manager Integration**: API keys are now automatically stored in AWS Secrets Manager for secure access.
- **Enhanced Secrets Manager Access**: Lambda functions can now retrieve API keys from Secrets Manager.

### Changed
- Refactored API Gateway module to accept a map of Lambda function ARNs and names.
- Updated IAM module for Lambda to accept a map of ECR repository ARNs.
- Modified root Terraform configuration (`main.tf`, `locals.tf`) to define and manage multiple Lambda functions and their ECR repositories.
- **API Key Management**: Updated `api_key_secret` module to use API keys generated by API Gateway instead of manual variables.

### Fixed
- **Bedrock Permission Issue**: Resolved `AccessDeniedException` when Lambda functions invoke Bedrock models.
  - Expanded Bedrock IAM policy to include all Anthropic Claude models with wildcard patterns
  - Added additional Bedrock actions: `CreateModelInvocationJob`, `InvokeModelWithResponseStream`, `ListFoundationModels`, `GetFoundationModel`
  - Changed resource pattern from specific ARN to `arn:aws:bedrock:*:*:foundation-model/anthropic.claude-*`
- **Secrets Manager Integration**: Fixed API key storage and retrieval workflow.
  - Lambda IAM role now includes `secretsmanager:GetSecretValue` permission
  - API keys are automatically stored in Secrets Manager with additional metadata (API ID, stage)

## [Previous Unreleased Content]

### Added
- Initial project setup with CloudFormation template (superseded by Terraform migration)
- Basic infrastructure components:
  - API Gateway with multiple endpoints
  - Lambda function with container image support
  - DynamoDB table for validation results
  - S3 bucket for data storage
  - ECR repository for Lambda container images
- API endpoints:
  - POST /validate for image validation
  - GET /catalog for unified catalog operations
  - GET /transaction/{transactionId} for transaction details
  - GET /transactions for transaction history
- Security features:
  - API Gateway API key requirement
  - S3 bucket public access blocking
  - ECR image scanning
  - Minimal IAM permissions
- Monitoring setup:
  - CloudWatch Logs
  - API Gateway access logs
  - DynamoDB metrics
  - ECR image scanning

### Changed
- Migrated from Lambda zip deployment to container-based deployment
- Updated Lambda function to use ECR container image
- Enhanced API Gateway configuration with CORS support
- Improved IAM role permissions for Lambda function

### Removed
- Lambda Layer configuration (replaced with container image)
- Direct S3 deployment for Lambda function code

## [0.1.0] - 2024-03-XX

### Added
- Initial project structure
- Basic CloudFormation template
- Core infrastructure components
- Basic API endpoints
- Security configurations
- Monitoring setup

### Security
- Implemented API key authentication
- Configured S3 bucket security
- Set up ECR repository security
- Applied least privilege IAM policies

### Infrastructure
- Created CloudFormation template
- Set up AWS resources
- Configured networking
- Implemented logging

### Documentation
- Added comprehensive README
- Created initial CHANGELOG
- Documented API endpoints
- Added deployment instructions
